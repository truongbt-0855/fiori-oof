<mvc:View
  controllerName="com.internal.oof.controller.CreateSO"
  xmlns="sap.m"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:core="sap.ui.core"
  xmlns:f="sap.ui.layout.form"
  xmlns:unified="sap.ui.unified"
  displayBlock="true"
>
  <Page title="{i18n>createSalesOrderTitle}" showNavButton="true" navButtonPress="onPageCreateSONavButtonPress" class="sapUiContentPadding">
    <content>
        <f:SimpleForm
        id="idCreateSOSimpleForm"
        layout="ResponsiveGridLayout"
        editable="true"
        labelSpanXL="3"
        labelSpanL="3"
        labelSpanM="3"
        labelSpanS="12"
        adjustLabelSpan="false"
        emptySpanXL="4"
        emptySpanL="4"
        emptySpanM="4"
        emptySpanS="0"
        columnsXL="1"
        columnsL="1"
        columnsM="1"
        singleContainerFullSize="false"
        class=""
      >
        <f:content>
          <!-- Header Information Section -->
          <core:Title text="{i18n>headerSectionTitle}" />
          
           <!-- Sold-to Customer -->
          <Label text="{i18n>soldToLabel}" required="true" />
          <ComboBox
            id="idSoldToComboBox"
            placeholder="{i18n>soldToPlaceholder}"
            selectedKey="{/soldToParty}"
            items="{/soldToPartyList}"
            valueState="{/soldToState}"
            valueStateText="{/soldToStateText}"
            selectionChange="onSoldToComboBoxSelectionChange"
            loadItems="onSoldToComboBoxOpen"
            showSecondaryValues="true"
            required="true"
          >
            <core:Item key="{name}" text="{name} - {description}" />
          </ComboBox>
          
          <!-- Ship-to Customer -->
          <Label text="{i18n>shipToLabel}" required="true" />
          <ComboBox
            id="idShipToComboBox"
            placeholder="{i18n>shipToPlaceholder}"
            selectedKey="{/shipToParty}"
            items="{/shipToPartyList}"
            valueState="{/shipToState}"
            valueStateText="{/shipToStateText}"
            selectionChange="onShipToComboBoxSelectionChange"
            loadItems="onShipToComboBoxOpen"
            showSecondaryValues="true"
            required="true"
          >
            <core:Item key="{name}" text="{name} - {description}" />
          </ComboBox>

          <!-- PO Number -->
          <Label text="{i18n>poNumberLabel}" required="true" />
          <Input
            id="idPONumberInput"
            value="{/poNumber}"
            placeholder="{i18n>poNumberPlaceholder}"
            valueState="{/poNumberState}"
            valueStateText="{/poNumberStateText}"
            change="onPONumberInputChange"
            required="true"
          />

          <!-- Request Delivery Date -->
          <Label text="{i18n>requestDeliveryDateLabel}" required="true" />
          <DatePicker
            id="idRequestDeliveryDatePicker"
            value="{/requestDeliveryDate}"
            placeholder="{i18n>requestDeliveryDatePlaceholder}"
            valueState="{/requestDeliveryDateState}"
            valueStateText="{/requestDeliveryDateStateText}"
            change="onRequestDeliveryDatePickerChange"
            minDate="{/minDeliveryDate}"
            required="true"
            valueFormat="yyyy-MM-dd"
          />

          <!-- Incoterms -->
          <Label text="{i18n>incotermsLabel}" required="true" />
          <ComboBox
            id="idIncotermsComboBox"
            placeholder="{i18n>incotermsPlaceholder}"
            selectedKey="{/incoterms}"
            items="{/incotermsList}"
            valueState="{/incotermsState}"
            valueStateText="{/incotermsStateText}"
            loadItems="onIncotermsComboBoxOpen"
            showSecondaryValues="true"
            required="true"
          >
            <core:Item key="{name}" text="{name} - {description}" />
          </ComboBox>

          <!-- Line Items Section -->
          <core:Title text="{i18n>lineItemsSectionTitle}" />
          
        </f:content>
      </f:SimpleForm>
      <!-- Line Items Table -->
      <Table
        id="idLineItemsTable"
        items="{/lineItems}"
        growing="true"
        growingThreshold="20"
        mode="SingleSelect"
        selectionChange="onLineItemSelectionChange"
      >
        <headerToolbar>
          <OverflowToolbar>
            <Title text="{i18n>lineItemsTableTitle}" level="H2" />
            <ToolbarSpacer />
            <Button
              id="idAddLineItemButton"
              text="{i18n>addLineItemButtonText}"
              type="Emphasized"
              press="onButtonAddLineItemPress"
              icon="sap-icon://add"
            />
            <Button
              id="idDeleteLineItemButton"
              text="{i18n>deleteLineItemButtonText}"
              press="onButtonDeleteLineItemPress"
              icon="sap-icon://delete"
              enabled="{= ${/selectedLineItemIndex} >= 0 }"
            />
          </OverflowToolbar>
        </headerToolbar>

        <columns>
          <Column>
            <Text text="{i18n>materialColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>quantityColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>uomColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>priceColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>plantColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>storageLocationColumnTitle}" />
          </Column>
          <Column>
            <Text text="{i18n>totalColumnTitle}" />
          </Column>
        </columns>

        <items>
          <ColumnListItem press="onColumnListItemPress">
            <cells>
              <!-- Material -->
              <Input
                value="{materialID}"
                placeholder="{i18n>materialIdPlaceholder}"
                valueHelpRequest="onMaterialValueHelpRequest"
                showValueHelp="true"
                valueState="{materialIDState}"
                valueStateText="{materialIDStateText}"
              />
              
              <!-- Quantity -->
              <Input
                value="{quantity}"
                placeholder="{i18n>quantityPlaceholder}"
                type="Number"
                change="onLineItemQuantityChange"
                valueState="{quantityState}"
                valueStateText="{quantityStateText}"
              />
              
              <!-- UoM -->
              <ComboBox
                selectedKey="{uom}"
                items="{uomList}"
                placeholder="{i18n>uomPlaceholder}"
                selectionChange="onLineItemUoMChange"
                valueState="{uomState}"
                valueStateText="{uomStateText}"
                busy="{uomLoading}"
              >
                <core:Item key="{AlternativeISOUnit}" text="{AlternativeISOUnit}" />
              </ComboBox>
              
              <!-- Price -->
              <Input
                value="{unitPrice}"
                placeholder="{i18n>pricePlaceholder}"
                type="Number"
                change="onLineItemPriceChange"
                valueState="{priceState}"
                valueStateText="{priceStateText}"
              />
              
              <!-- Plant -->
              <ComboBox
                selectedKey="{plant}"
                items="{/plantsList}"
                placeholder="{i18n>plantPlaceholder}"
                selectionChange="onLineItemPlantChange"
                valueState="{plantState}"
                valueStateText="{plantStateText}"
              >
                <core:Item key="{plantCode}" text="{plantCode} - {plantName}" />
              </ComboBox>
              
              <!-- Storage Location -->
              <ComboBox
                selectedKey="{storageLocation}"
                items="{storageLocations}"
                placeholder="{i18n>storageLocationPlaceholder}"
                selectionChange="onLineItemStorageLocationChange"
                valueState="{storageLocationState}"
                valueStateText="{storageLocationStateText}"
              >
                <core:Item key="{locationCode}" text="{locationCode} - {locationName}" />
              </ComboBox>
              
              <!-- Total -->
              <ObjectNumber
                number="{totalPrice}"
                unit="{currency}"
                state="Success"
                emphasized="true"
              />
            </cells>
          </ColumnListItem>
        </items>
      </Table>

      <!-- Attachments Section -->
      <Panel
        id="idAttachmentsPanel"
        headerText="{i18n>attachmentsSectionTitle}"
        expandable="true"
        expanded="false"
        class="sapUiSmallMarginTop"
      >
        <content>
          <VBox class="sapUiMediumMargin">
            <Label text="Upload Files (Max 5 files, 50MB each)" class="sapUiTinyMarginBottom" />
            <HBox alignItems="Center" class="sapUiTinyMarginBottom">
              <unified:FileUploader
                id="idFileUploader"
                buttonText="Choose Files"
                placeholder="Select files to upload"
                fileType="pdf,doc,docx,txt,jpg,png,xlsx"
                maximumFilenameLength="100"
                change="onFileUploaderChange"
                class="sapUiMediumMarginEnd"
                multiple="true"
                maximumFileSize="50"
              />
            </HBox>
            
            <!-- Uploaded Files List -->
            <List 
              id="idAttachedFilesList"
              items="{/attachedFiles}"
              class="sapUiSmallMarginTop"
            >
              <CustomListItem>
                <content>
                  <HBox justifyContent="SpaceBetween" alignItems="Center" width="100%">
                    <VBox class="sapUiMediumMarginEnd">
                      <Text text="{fileName}" class="sapUiMediumText" />
                      <Text text="{fileSize} â€¢ {fileType}" class="sapUiTinyText" />
                    </VBox>
                    <Button 
                      icon="sap-icon://delete" 
                      type="Transparent" 
                      press="onDeleteAttachmentPress"
                      tooltip="Delete file" />
                  </HBox>
                </content>
              </CustomListItem>
            </List>
            
            <Text text="Supported formats: PDF, DOC, DOCX, TXT, JPG, PNG, XLSX" 
                  class="sapUiTinyText sapUiSmallMarginTop" />
          </VBox>
        </content>
      </Panel>

      <!-- Order Summary -->
      <Panel
        id="idOrderSummaryPanel"
        headerText="{i18n>orderSummaryTitle}"
        class="sapUiSmallMarginTop"
      >
        <content>
          <f:SimpleForm
            layout="ResponsiveGridLayout"
            editable="false"
            labelSpanXL="6"
            labelSpanL="6"
            labelSpanM="6"
            labelSpanS="12"
          >
            <f:content>
              <Label text="{i18n>totalItemsLabel}" />
              <Text text="{/totalItems}" />
              
              <Label text="{i18n>netAmountLabel}" />
              <ObjectNumber 
                number="{/netAmount}" 
                unit="{/currency}"
                state="Success"
                emphasized="true"
              />
              
              <Label text="{i18n>totalAmountLabel}" />
              <ObjectNumber 
                number="{/totalAmount}" 
                unit="{/currency}"
                state="Success"
                emphasized="true"
              />
            </f:content>
          </f:SimpleForm>
        </content>
      </Panel>
    </content>

    <footer>
      <OverflowToolbar>
        <ToolbarSpacer />
        <Button
          id="idCancelButton"
          text="{i18n>cancelButtonText}"
          press="onButtonCancelPress"
        />
        <Button
          id="idSaveButton"
          text="{i18n>saveButtonText}"
          type="Emphasized"
          press="onButtonSavePress"
        />
      </OverflowToolbar>
    </footer>
  </Page>
</mvc:View>
